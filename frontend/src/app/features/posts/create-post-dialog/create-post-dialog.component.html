<div class="create-post-dialog">
  <div class="dialog-header">
    <h2 mat-dialog-title>Create a post</h2>
    <button mat-icon-button mat-dialog-close>
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-dialog-content>
    <form [formGroup]="postForm">
      <!-- Community Select -->
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Choose a community</mat-label>
        <mat-select formControlName="community_id" required>
          <mat-option *ngFor="let community of communities" [value]="community.id">
            <div class="community-option">
              <mat-icon>forum</mat-icon>
              <span>c/{{ community.name }}</span>
            </div>
          </mat-option>
        </mat-select>
        <mat-error *ngIf="postForm.get('community_id')?.hasError('required')">
          Please select a community
        </mat-error>
      </mat-form-field>

      <!-- Post Type Tabs -->
      <mat-tab-group (selectedTabChange)="onTabChange($event)" class="post-type-tabs">
        <!-- Text Post Tab -->
        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon>article</mat-icon>
            <span>Post</span>
          </ng-template>
          
          <div class="tab-content">
            <!-- Title -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Title</mat-label>
              <input 
                matInput 
                formControlName="title" 
                placeholder="An interesting title"
                maxlength="300"
                required
              />
              <mat-hint align="end">{{ postForm.get('title')?.value?.length || 0 }}/300</mat-hint>
              <mat-error *ngIf="postForm.get('title')?.hasError('required')">
                Title is required
              </mat-error>
            </mat-form-field>

            <!-- Content -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Text (optional)</mat-label>
              <textarea 
                matInput 
                formControlName="content" 
                rows="8"
                placeholder="Text (optional)"
              ></textarea>
              <mat-hint>You can use markdown formatting</mat-hint>
            </mat-form-field>
          </div>
        </mat-tab>

        <!-- Image Post Tab -->
        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon>image</mat-icon>
            <span>Image</span>
          </ng-template>
          
          <div class="tab-content">
            <!-- Title -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Title</mat-label>
              <input 
                matInput 
                formControlName="title" 
                placeholder="An interesting title"
                maxlength="300"
                required
              />
              <mat-hint align="end">{{ postForm.get('title')?.value?.length || 0 }}/300</mat-hint>
              <mat-error *ngIf="postForm.get('title')?.hasError('required')">
                Title is required
              </mat-error>
            </mat-form-field>

            <!-- Image Upload -->
            <div class="image-upload-section">
              <div class="upload-area" 
                   [class.has-image]="imagePreview"
                   (click)="fileInput.click()"
                   (dragover)="onDragOver($event)"
                   (drop)="onDrop($event)">
                
                <div *ngIf="!imagePreview" class="upload-placeholder">
                  <mat-icon>cloud_upload</mat-icon>
                  <p>Drag and drop image or click to browse</p>
                  <span class="upload-hint">JPG, PNG, GIF - Max 5MB</span>
                </div>

                <div *ngIf="imagePreview" class="image-preview">
                  <img [src]="imagePreview" alt="Preview" />
                  <button 
                    mat-mini-fab 
                    color="warn" 
                    class="remove-image-btn"
                    (click)="removeImage($event)"
                  >
                    <mat-icon>close</mat-icon>
                  </button>
                </div>

                <input 
                  #fileInput 
                  type="file" 
                  accept="image/*" 
                  (change)="onFileSelected($event)"
                  hidden
                />
              </div>

              <mat-progress-bar 
                *ngIf="isUploading" 
                mode="indeterminate"
                class="upload-progress"
              ></mat-progress-bar>
            </div>
          </div>
        </mat-tab>

        <!-- Link Post Tab -->
        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon>link</mat-icon>
            <span>Link</span>
          </ng-template>
          
          <div class="tab-content">
            <!-- Title -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Title</mat-label>
              <input 
                matInput 
                formControlName="title" 
                placeholder="An interesting title"
                maxlength="300"
                required
              />
              <mat-hint align="end">{{ postForm.get('title')?.value?.length || 0 }}/300</mat-hint>
              <mat-error *ngIf="postForm.get('title')?.hasError('required')">
                Title is required
              </mat-error>
            </mat-form-field>

            <!-- Link URL -->
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>URL</mat-label>
              <input 
                matInput 
                formControlName="content" 
                placeholder="https://example.com"
                type="url"
              />
              <mat-error *ngIf="postForm.get('content')?.hasError('pattern')">
                Please enter a valid URL
              </mat-error>
            </mat-form-field>
          </div>
        </mat-tab>
      </mat-tab-group>

      <!-- Rules Card -->
      <mat-card class="rules-card">
        <mat-card-content>
          <div class="rules-header">
            <mat-icon>info</mat-icon>
            <span>Please remember:</span>
          </div>
          <ul class="rules-list">
            <li>Be respectful and civil</li>
            <li>Stay anonymous - don't share personal info</li>
            <li>Follow community guidelines</li>
            <li>No spam or self-promotion</li>
          </ul>
        </mat-card-content>
      </mat-card>
    </form>
  </mat-dialog-content>

  <mat-dialog-actions align="end">
    <button mat-button mat-dialog-close>Cancel</button>
    <button 
      mat-raised-button 
      color="primary" 
      (click)="onSubmit()"
      [disabled]="postForm.invalid || isSubmitting"
    >
      <mat-spinner diameter="20" *ngIf="isSubmitting"></mat-spinner>
      <span *ngIf="!isSubmitting">Post</span>
    </button>
  </mat-dialog-actions>
</div>